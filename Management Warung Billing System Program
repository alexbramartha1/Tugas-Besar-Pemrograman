#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

int ch;
int no;
int no2;
int i;
int total_bar[100];
char c;
int banyak;
float uang;
double harga_bar[1000], hasil, hasil2, hasil3[1000], harga_bar_benar;
char pegawai[100];
char pengemudi[100];
char customer[100];
char nama_bar[100][100];
char type[25];
int quant = 0;
time_t waktuserver;

typedef struct{
    char nama[100];
    char username[20];
    char password[20];
    char no_hp[15];
}User;

User u;

typedef struct{
	char name[20];
	int cost;
	int quantity;
	int price;
}t1;

t1 t;

void header();
void menu_log();
void sign_in();
void sign_up();
void record(User u1, char file[]);
char namaFile[] = "Login User";

void waktu();
void acak_id();

void add();
void display();
char recordInven[] = "Penampungan";

void pilihan_menu();
void menambahkan_barang();
void kasir_online();
void kasir_offline();
void struk();
void struk2();


int main(){
    system("color F0");
    header();
    system("cls");
}

void header(){
    system ("cls");
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                  Management Warung             \n");
	printf("\t\t\t\t\t               Billing System Program           \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\t       Program dibuat berkelompok 2 orang oleh:     \n");
	printf("\t\t\t\t\t    1. I Gede Alex Bramartha		(2105551024)  \n");
	printf("\t\t\t\t\t    2. I Made Satya Rama Sai Natha	(2105551039)  \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\t       Selamat Datang di Program Management Warung \n");
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t       	 Tekan ENTER untuk memulai program \n");
	getch();
    system("cls");
    menu_log();
}


void menu_log(){
    int pilihan;

    start:
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                    Pilih Cara Masuk	              \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\t    1. Sign In								  	 \n");
	printf("\t\t\t\t\t    2. Sign Up								     \n");
	printf("\t\t\t\t\t    3. Exit       							     \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\t        Welcome to Program Management Warung 	  \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
  	printf("\t\t\t\t\t      Masukkan angka pilihan untuk melanjutkan = ");
	scanf("%d", &pilihan);
	
    system("cls");

    switch(pilihan){
    	case 1:
        	sign_in();
       		break;
    	case 2:
        	sign_up();
        	break;
    	case 3:
		printf("Terima Kasih sudah menggunakan Program ini!");
        	getch();
        	break;
    	default:
        	goto start;
        	break;
    }
}

void sign_in(){
    char username[20];
    char password[20];
    int pilihan;

    FILE *record;

    record = fopen (namaFile, "r");
    if(record == NULL){
        printf("Maaf Penyimpanan File TIDAK TERSEDIA\n");
        sign_up();
    }

	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t\t                   Sign In	              \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
    printf("\t\t\t\t\t	Username : ");
    scanf("%s", username);
    printf("\t\t\t\t\t	Password : ");
    scanf("%s", password);

    system("cls");

    while(fread(&u,sizeof(u),1,record)){
        if(strcmp(username, u.username)==0 && strcmp(password, u.password)==0){
		printf("\t\t\t\t\t=========================================================\n");
		printf("\t\t\t\t\t                    Sign In SUCCESS!	                   \n");
		printf("\t\t\t\t\t---------------------------------------------------------\n");
		getch();
		system("cls");
			
		pilihan_menu();
        }
        else{
		printf("\t\t\t\t\t=========================================================\n");
		printf("\t\t\t\t\t                 Akun Anda BELUM TERDAFTAR	           \n");
		start:
		printf("\t\t\t\t\t---------------------------------------------------------\n");
		printf("\t\t\t\t\t    1. Sign In								  	 \n");
		printf("\t\t\t\t\t    2. Sign Up								     \n");
		printf("\t\t\t\t\t    3. Exit									  	 \n");
		printf("\t\t\t\t\t---------------------------------------------------------\n");
            	printf("\n\t\t\t\t\t  Pilihan : ");
            	scanf("%d", &pilihan);
            
		system("cls");

		if(pilihan == 1){
			sign_in();
		} 
		else if(pilihan == 2){
			sign_up();
		} 
		else if(pilihan == 3){
			printf("Terima Kasih sudah menggunakan Program ini!");
			getch();
			break;
		 } 
		 else{
			printf ("\t\t\t\t\t ERROR");
			goto start;
            }
        }
    }
    fclose(record);
    return;
}

void sign_up(){
    FILE *regis;

    regis = fopen(namaFile,"w");

    if(regis == NULL){
        printf("ERROR, Tidak ada File!");
        exit(1);
    }
    
    printf("\t\t\t\t\t=========================================================\n");
    printf("\t\t\t\t\t               Silahkan Isi Data Diri Anda	           \n");
    printf("\t\t\t\t\t---------------------------------------------------------\n");
    getch();
    printf("\t\t\t\t\t Nama Lengkap    : ");
    scanf("\n%[^\n]s", u.nama);
    printf("\t\t\t\t\t Nomor Handphone : ");
    scanf("%s", u.no_hp);
    printf("\t\t\t\t\t---------------------------------------------------------\n\n");
    printf("\t\t\t\t\t Hey %s!\n", u.nama);
    printf("\t\t\t\t\t Buat username dan password anda\n");
    printf("\t\t\t\t\t---------------------------------------------------------\n");
    getch();
    printf("\t\t\t\t\t Enter Username : ");
    scanf("\n%s", u.username);
    printf("\t\t\t\t\t Enter Password : ");
    scanf("%s", u.password);
    fwrite(&u,sizeof(u),1,regis);
    fclose(regis);
    printf("\n\t\t\t\t\t Sign Up Success!");
    printf("\n\t\t\t\t\t Akun anda sudah dibuat!");
    getch();
	
    system("cls");
    sign_in();
}

void pilihan_menu(){
	int pilihan;
	
	do{
	system("cls");	
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                 Menu Plihan Pembayaran	               \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\t    1. Kasir Offline   					\n");
	printf("\t\t\t\t\t    2. Kasir Online						\n");
	printf("\t\t\t\t\t    3. Tambah Barang						\n");
	printf("\t\t\t\t\t    4. Display Barang          				\n");
	printf("\t\t\t\t\t    5. Exit							\n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
  	printf("\t\t\t\t\t      Masukkan angka pilihan untuk melanjutkan = ");
	scanf("%d", &pilihan);
    
	system("cls");
    
    	switch(pilihan){
    		case 1:
    		     kasir_offline();
        	     break;
    		case 2:
    		     kasir_online();
        	     break;
    		case 3:
		     add();
        	     break;
		case 4:
		     display();
		     break;	
		case 5:
		     system("cls");
		     printf("\t\t\t\t\t=========================================================\n");
		     printf("\t\t\t\t\t        Terima Kasih Sudah Menggunakan Program Ini       \n");
		     printf("\t\t\t\t\t---------------------------------------------------------\n");
		     getch();
		     system("cls");	
		     exit(0);
		     break;
   		}	
	}
	while(pilihan != 5);
	system("cls");
}

void kasir_offline(){
	int pilihan;
	char pilih1, pilih2, utama;
	
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                      Kasir Offline                \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");	
	printf("\t\t\t\t\t    1. Kasir          				   \n");
	printf("\t\t\t\t\t    2. Display Barang				           \n");
	printf("\t\t\t\t\t    3. Kembali ke Menu Pembayaran		           \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
  	printf("\t\t\t\t\t      Masukkan angka pilihan untuk melanjutkan = ");
	scanf("%d", &pilihan);
	
	switch(pilihan){
   		case 1:
   		    start:
   		    printf("\n\t\t\t\t\tNama Pegawai Kasir => ");
		    scanf("\n%[^\n]s", &pegawai);
			
		    printf("\t\t\t\t\tNama Customer      => ");
	            scanf("\n%[^\n]s", &customer);
			
		    printf("\n\t\t\t\t\tPilih Tipe Pembelian (Take Away / Dine In)\n");
	            printf("\t\t\t\t\tTipe Pembelian     => ");
		    scanf("\n%[^\n]s", &type);			
  		
		    printf("\n\t\t\t\t\tBerapa barang yang dibeli? \n");
		    printf("\t\t\t\t\t=> ");
		    scanf("%d", &banyak);
		    getchar();
			
		    for(i = 0; i < banyak; i++){
			printf("\n\t\t\t\t\tBarang yang Dibeli => ");
		        scanf("\n%[^\n]s", &nama_bar[i]);

			printf("  \t\t\t\t\tHarga Produk       => Rp. ");
			scanf("%lf", &harga_bar[i]);
				
			printf("  \t\t\t\t\tTotal Produk       => ");
			scanf("%d", &total_bar[i]);
				
			hasil += harga_bar[i] * total_bar[i];
		}		
			
			hasil2 = uang - hasil;

			start2:
			printf("\n\t\t\t\t\tUang Customer      => Rp. ");
			scanf("%f", &uang);
			
			hasil2 = uang - hasil;
			
			if(uang < hasil){
			  system("cls");
			  printf("\t\t\t\t\t=========================================================\n");
			  printf("\t\t\t\t\t                  MAAF TIDAK TERIMA BON!                 \n");
			  printf("\t\t\t\t\t---------------------------------------------------------\n");
			  getch();
			  goto start2;
			}
			
			else{
			    printf("\n\t\t\t\t\tApakah yakin ingin mencetak struk? (y/t) ");
			    scanf("\n%c", &pilih2);
			
			    if(pilih2 == 'y'){
				getch();
				struk();
				system("cls");
			}
			    else{
				system("cls");
				goto start;
			}	
		}

		getch();
		system("cls");
		struk();
			
		getch();
		system("cls");
			
		printf("\n\t\t\t\t\tApakah ingin ke Menu Utama? (y/t) ");
		scanf("\n%c", &utama);
			
		if(utama == 'y'){
		    getch();
		    system("cls");
		    pilihan_menu();
		}
			
		else{
		     system("cls");
		     printf("\t\t\t\t\t=========================================================\n");
		     printf("\t\t\t\t\t        Terima Kasih Sudah Menggunakan Program Ini       \n");
		     printf("\t\t\t\t\t---------------------------------------------------------\n");
		     getch();
		     system("cls");	
		     exit(0);
		}	
		break;
		   	
   	case 2:
   	    display();
   	    printf("\t\t\t\t\tApakah ingin ke kasir? (y/t) ");
   	    scanf("\n%c", &pilih1);
   			
   	    if(pilih1 == 'y'){
   		getch();
   		goto start;
	    }
			
	    else{
	        pilihan_menu();	
	    }
       		break;
       		
   	case 3:
		pilihan_menu();
       		break;
   	}	
	
	getch();
        system("cls");
}

void kasir_online(){
	int pilihan;
	char pilih1, pilih2, utama;
	
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                      Kasir Online                 \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");	
	printf("\t\t\t\t\t    1. Kasir          							 \n");
	printf("\t\t\t\t\t    2. Display Barang						         \n");
	printf("\t\t\t\t\t    3. Kembali ke Menu Pembayaran				     \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
  	printf("\t\t\t\t\t      Masukkan angka pilihan untuk melanjutkan = ");
	scanf("%d", &pilihan);
	
	switch(pilihan){
   		case 1:
   			start:
   			printf("\n\t\t\t\t\tNama Pegawai Kasir   => ");
			scanf("\n%[^\n]s", &pegawai);
			
			printf("\t\t\t\t\tNama Pengemudi       => ");
			scanf("\n%[^\n]s", &pengemudi);
			
			printf("\t\t\t\t\tNama Customer        => ");
			scanf("\n%[^\n]s", &customer);
			
			printf("\n\t\t\t\t\tPilih Aplikasi (GoFood / GrabFood / ShopeeFood\n");
			printf("\t\t\t\t\tAplikasi Pemesanan   => ");
			scanf("\n%[^\n]s", &type);			
  		
		   	printf("\n\t\t\t\t\tBerapa barang yang dibeli? \n");
			printf("\t\t\t\t\t=> ");
			scanf("%d", &banyak);
			getchar();
			
			for(i = 0; i < banyak; i++){
				printf("\n\t\t\t\t\tBarang yang Dibeli => ");
				scanf("\n%[^\n]s", &nama_bar[i]);

				printf("  \t\t\t\t\tHarga Produk       => Rp. ");
				scanf("%lf", &harga_bar[i]);
				
				printf("  \t\t\t\t\tTotal Produk       => ");
				scanf("%d", &total_bar[i]);
				
				hasil += (harga_bar[i] + (harga_bar[i] * 0.2)) * total_bar[i];
			}		
			start2:
			printf("\n\t\t\t\t\tUang Customer      => Rp. ");
			scanf("%f", &uang);
			
			hasil2 = uang - hasil;
			
			if(uang < hasil){
			    system("cls");
			    printf("\t\t\t\t\t=========================================================\n");
			    printf("\t\t\t\t\t                  MAAF TIDAK TERIMA BON!                 \n");
			    printf("\t\t\t\t\t---------------------------------------------------------\n");
			    getch();
			    goto start2;
			}
			
			else{
			    printf("\n\t\t\t\t\tApakah yakin ingin mencetak struk? (y/t) ");
			    scanf("\n%c", &pilih2);
			
			    if(pilih2 == 'y'){
				getch();
				struk2();
				system("cls");
			    }
			    else{
				system("cls");
				goto start;
			    }	
			}
			
			getch();
			system("cls");
			struk2();
			
			getch();
			system("cls");
			
			printf("\n\t\t\t\t\tApakah ingin ke Menu Utama? (y/t) ");
			scanf("\n%c", &utama);
			
			if(utama == 'y'){
				getch();
				system("cls");
				pilihan_menu();
			}
			
			else{
				system("cls");
				printf("\t\t\t\t\t=========================================================\n");
				printf("\t\t\t\t\t        Terima Kasih Sudah Menggunakan Program Ini       \n");
				printf("\t\t\t\t\t---------------------------------------------------------\n");
				getch();
				system("cls");	
				exit(0);
			}	
		   	break;
		   	
   		case 2:
   			display();
   			printf("\t\t\t\t\tApakah ingin ke kasir? (y/t) ");
   			scanf("\n%c", &pilih1);
   			
   			if(pilih1 == 'y'){
   			    getch();
   			    goto start;
			   }
			else{
			    pilihan_menu();	
			}
       			break;
       		
   		case 3:
		    pilihan_menu();
       		    break;
   	}	
	
	getch();
        system("cls");
}

void add(){
    system("cls");
	
    printf("\t\t\t\t\t=========================================================\n");
    printf("\t\t\t\t\t                     Tambah Produk                \n");
    printf("\t\t\t\t\t---------------------------------------------------------\n");
	
    printf("\n\t\t\t\t\tBerapa barang yang ingin ditambahkan? \n");
    printf("\t\t\t\t\t=> ");
    scanf("%d", &no);
	
    FILE *fp;
	
    fp = fopen (recordInven, "a");
	
    for(i = 0; i < no; i++){
	printf("\n\t\t\t\t\tNama Produk   : ");
	scanf("\n%[^\n]s", t.name);
		
	printf("  \t\t\t\t\tHarga Produk  : Rp. ");
	scanf("%d", &t.price);
		
	fprintf(fp, "\t\t\t\t\t\t%s \n", t.name);
	fprintf(fp, "\t\t\t\t\t\t=> Rp. %d \n\n", t.price);
	}	
	
	fclose(fp);
	getch();
	system("cls");
	pilihan_menu();
}

void display(){
	char pilihan;
	FILE *fp;
	
	fp = fopen (recordInven, "r");

	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                     Produk Tersedia                \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	
	while((c = getc(fp)) != EOF){	
	    printf("%c", c);
	}
	printf("\t\t\t\t\t---------------------------------------------------------\n");
	fclose(fp);
	getch();
}

void waktu(){
    time(&waktuserver);
    struct tm *waktu = localtime (&waktuserver);
    printf("%i/%i/%i-%d:%d", waktu -> tm_mday, waktu -> tm_mon + 1, waktu -> tm_year + 1900, waktu -> tm_hour,  waktu -> tm_min);
} 

void struk(){
    printf("\t\t\t\t\t=========================================================\n");
    printf("\t\t\t\t\t                     Rincian Pembelian                   \n");
    printf("\t\t\t\t\t---------------------------------------------------------\n");	
    printf("\t\t\t\t\t%s - ", pegawai); waktu(); 
    printf("\n\t\t\t\t\tId : "); acak_id();
    printf("\t\t\t\t\t---------------------------------------------------------\n");

    printf("\t\t\t\t\tCustomer - %s", customer);
    printf("\n\t\t\t\t\tTipe %s", type);
	
    printf("\n\n\t\t\t\t\tBarang yang Dibeli: \n");

    for(i = 0; i < banyak; i++){
	printf("\t\t\t\t\t- %s x%d\n", nama_bar[i], total_bar[i]);
	printf("\t\t\t\t\t => %.lf\n", harga_bar[i]);
	}
	
	printf("\n\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\tTotal Harga   => Rp. %.lf\n", hasil);
	printf("\t\t\t\t\tUang Customer => Rp. %.f\n", uang);	
	printf("\t\t\t\t\tKembalian     => Rp. %.lf\n", hasil2);
	printf("\t\t\t\t\t=========================================================\n");
}

void struk2(){
	printf("\t\t\t\t\t=========================================================\n");
	printf("\t\t\t\t\t                     Rincian Pembelian                   \n");
	printf("\t\t\t\t\t---------------------------------------------------------\n");	
	printf("\t\t\t\t\t%s - ", pegawai); waktu(); 
	printf("\n\t\t\t\t\tId : "); acak_id();
	printf("\t\t\t\t\t---------------------------------------------------------\n");

	printf("\t\t\t\t\tCustomer - %s", customer);
	printf("\n\t\t\t\t\tTipe %s", type);
	printf("\n\t\t\t\t\tPengemudi - %s", pengemudi);
	
	printf("\n\n\t\t\t\t\tBarang yang Dibeli: \n");

	for(i = 0; i < banyak; i++){
	    printf("\t\t\t\t\t- %s x%d\n", nama_bar[i], total_bar[i]);
	    printf("\t\t\t\t\t => %.lf\n", harga_bar[i]);
	}
	
	printf("\n\t\t\t\t\t---------------------------------------------------------\n");
	printf("\t\t\t\t\tKomisi Aplikasi  => 20% \n");
	printf("\t\t\t\t\tTotal Harga      => Rp. %.lf\n", hasil);
	printf("\t\t\t\t\tUang Customer    => Rp. %.f\n", uang);	
	printf("\t\t\t\t\tKembalian        => Rp. %.lf\n", hasil2);
	printf("\t\t\t\t\t=========================================================\n");
}

void acak_id(){
    static const char huruf[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    const size_t jumlah = sizeof(huruf) - 27; 
    size_t i, j;

    srand(time(NULL));

    for(i = 0; i < 1; i++) {
        for(j = 0; j < jumlah; j++) {
            char random_char;
            int random_index = (double)rand() / RAND_MAX * jumlah;
            
            random_char = huruf[random_index];
            printf("%c", random_char);
        }
        printf("\n");
    }
}



